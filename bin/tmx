#!/bin/bash

PATH=/bin:/usr/bin:~/bin
targetses=${1:-all}

if [ "$targetses" = "ls" ]; then
    # list the sessions
    exec tmux ls
else
    mytty=$(tty | cut -f3- -d/)
    sessionname="$targetses"
    sessioninstance="$targetses $mytty"
    if tmux has-session -t "$targetses"; then
        # found the requested session, attach to it
        exec agenttmux -2 new-session -s "$sessioninstance" -t "$sessionname" 
    fi
    # create a new detached session, set an option on it, and attach to it
    exec agenttmux -2 \
        new-session -d -s "$sessionname" \; \
        set -t "$targetses" destroy-unattached off \; \
        new-session -s "$sessioninstance" -t "$sessionname"
fi

